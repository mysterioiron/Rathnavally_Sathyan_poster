<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Poster Editor</title>

<meta property="og:title" content="Check out my poster!">
<meta property="og:description" content="Create and download your own poster using this editor.">
<meta property="og:image" content="https://github.com/RathnavalliSathyan-make-your-poster/poster_generator/blob/main/WhatsApp%20Image%202025-11-22%20at%2007.34.17_e0b8aebb.jpg?raw=true">
<meta property="og:url" content="https://rathnavallisathyan-make-your-poster.github.io/poster_generator/">
<meta property="og:type" content="website">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Check out my poster!">
<meta name="twitter:description" content="Create and download your own poster using this editor.">
<meta name="twitter:image" content="https://github.com/RathnavalliSathyan-make-your-poster/poster_generator/blob/main/WhatsApp%20Image%202025-11-22%20at%2007.34.17_e0b8aebb.jpg?raw=true">
</head>
<body>

<h2>Upload or Capture a Picture</h2>

<div class="slider-container">
Â  <label for="sizeSlider">Size:</label>
Â  <input type="range" id="sizeSlider" min="0.3" max="3" step="0.01" value="1">
</div>

<div class="canvas-wrapper" id="canvasWrapper">

Â  <div class="upload-row" id="uploadRow">
Â  Â  <label class="upload-btn" for="imgUploadInput">ğŸ“ Upload</label>
Â  Â  <button id="cameraBtn">ğŸ“¸ Camera</button>
Â  </div>

Â  <canvas id="finalCanvas"></canvas>

Â  <input type="file" id="imgUploadInput" accept="image/*">
Â  <input type="file" id="imgCameraInput" accept="image/*" capture="environment">
</div>

<div style="display: flex; gap: 10px;">
Â  <button id="downloadBtn">Download</button>
Â  <button id="resetBtn">Reset</button>
</div>

<style>
body {
Â  font-family: Arial, sans-serif;
Â  display: flex;
Â  flex-direction: column;
Â  align-items: center;
Â  gap: 12px;
Â  padding: 20px;
Â  background: #f2f2f2;
}

.canvas-wrapper {
Â  position: relative;
Â  display: inline-block;
}

.upload-row {
Â  position: absolute;
Â  z-index: 10;
Â  background: rgba(255,255,255,0.85);
Â  padding: 10px;
Â  border-radius: 12px;
Â  display: flex;
Â  gap: 6px;
}

.upload-btn, #cameraBtn {
Â  background: white;
Â  border: 1px solid #bbb;
Â  padding: 6px 10px;
Â  border-radius: 6px;
Â  font-size: 14px;
Â  cursor: pointer;
}
.upload-btn:hover, #cameraBtn:hover {
Â  background: #f0f0f0;
}

input[type="file"] { display: none; }

canvas {
Â  width: 95%;
Â  height: auto;
Â  display: block;
Â  touch-action: none;
Â  background: #eee;
Â  cursor: grab;
}

#downloadBtn, #resetBtn {
Â  margin-top: 15px;
Â  background: white;
Â  border: 1px solid #bbb;
Â  padding: 10px 16px;
Â  font-size: 16px;
Â  border-radius: 8px;
Â  cursor: pointer;
}
#downloadBtn:hover, #resetBtn:hover {
Â  background: #f0f0f0;
}

.slider-container {
Â  display: flex;
Â  align-items: center;
Â  gap: 8px;
}
</style>

<script>
const canvas = document.getElementById("finalCanvas");
const ctx = canvas.getContext("2d");
const sizeSlider = document.getElementById("sizeSlider");
const uploadRow = document.getElementById("uploadRow");
const canvasWrapper = document.getElementById("canvasWrapper");
const downloadBtn = document.getElementById("downloadBtn");
const resetBtn = document.getElementById("resetBtn");

let downloadCount = 1;

/* POSTER IMAGE */
const poster = new Image();
// *** IMPORTANT FIX 1: Set crossOrigin for external images to prevent canvas tainting ***
poster.crossOrigin = "anonymous"; 
poster.src = "https://github.com/RathnavalliSathyan-make-your-poster/poster_generator/blob/main/WhatsApp%20Image%202025-11-22%20at%2007.34.17_e0b8aebb.jpg?raw=true";

/* FRAME ON POSTER */
const frame = {
Â  x: 371,
Â  y: 1340,
Â  r: Math.hypot(592 - 363, 1318 - 1330) * 0.9,
Â  img: null
};

let imgScale = 1;
let posX = 0, posY = 0;
let isDragging = false;
let startX = 0, startY = 0;
let lastTouchDistance = null;

function mapToDisplayed(x, y) {
Â  const displayWidth = canvas.clientWidth;
Â  const factor = displayWidth / canvas.width;
Â  return { dx: x * factor, dy: y * factor };
}

function updateUploadRowPosition() {
Â  const p = mapToDisplayed(frame.x, frame.y);
Â  const buttons = uploadRow.getBoundingClientRect();
Â  uploadRow.style.left = p.dx - buttons.width / 2 + "px";
Â  uploadRow.style.topÂ  = p.dy - buttons.height / 2 + "px";
}

poster.onload = () => {
Â  canvas.width = poster.width;
Â  canvas.height = poster.height;
Â  draw();
Â  updateUploadRowPosition();
};

function draw() {
Â  ctx.clearRect(0,0,canvas.width,canvas.height);
Â  ctx.drawImage(poster, 0, 0);

Â  if(frame.img){
Â  Â  ctx.save();
Â  Â  ctx.beginPath();
Â  Â  ctx.arc(frame.x, frame.y, frame.r, 0, Math.PI*2);
Â  Â  ctx.clip();

Â  Â  ctx.drawImage(
Â  Â  Â  frame.img,
Â  Â  Â  posX,
Â  Â  Â  posY,
Â  Â  Â  frame.img.width * imgScale,
Â  Â  Â  frame.img.height * imgScale
Â  Â  );

Â  Â  ctx.restore();
Â  }

Â  ctx.beginPath();
Â  ctx.arc(frame.x, frame.y, frame.r, 0, Math.PI*2);
Â  ctx.lineWidth = 2;
Â  ctx.strokeStyle = "#fff";
Â  ctx.stroke();
}

function handleImageSelect(e){
Â  const file = e.target.files[0];
Â  if(!file) return;

Â  uploadRow.style.display = "none";

Â  const img = new Image();
Â  img.onload = () => {
Â  Â  frame.img = img;

Â  Â  imgScale = 1;
Â  Â  posX = frame.x - img.width/2;
Â  Â  posY = frame.y - img.height/2;

Â  Â  sizeSlider.value = 1;
Â  Â  draw();
Â  };

Â  img.src = URL.createObjectURL(file);
Â  downloadCount = 1;
}

/* TOUCH drag */
canvas.addEventListener("touchstart", e=>{
Â  if(!frame.img) return;
Â  if(e.touches.length === 1){
Â  Â  isDragging = true;
Â  Â  startX = e.touches[0].clientX;
Â  Â  startY = e.touches[0].clientY;
Â  } else if(e.touches.length === 2){
Â  Â  lastTouchDistance = Math.hypot(
Â  Â  Â  e.touches[0].clientX - e.touches[1].clientX,
Â  Â  Â  e.touches[0].clientY - e.touches[1].clientY
Â  Â  );
Â  }
});

canvas.addEventListener("touchmove", e=>{
Â  if(!frame.img || (!isDragging && e.touches.length === 1)) return;
Â  e.preventDefault();

Â  if(e.touches.length === 1 && isDragging){
Â  Â  posX += e.touches[0].clientX - startX;
Â  Â  posY += e.touches[0].clientY - startY;
Â  Â  startX = e.touches[0].clientX;
Â  Â  startY = e.touches[0].clientY;
Â  } else if(e.touches.length === 2){
Â  Â  const dist = Math.hypot(
Â  Â  Â  e.touches[0].clientX - e.touches[1].clientX,
Â  Â  Â  e.touches[0].clientY - e.touches[1].clientY
Â  Â  );
Â  Â  if(lastTouchDistance){
Â  Â  Â  imgScale *= dist / lastTouchDistance;
Â  Â  Â  sizeSlider.value = imgScale;
Â  Â  }
Â  Â  lastTouchDistance = dist;
Â  }
Â  draw();
});

canvas.addEventListener("touchend", ()=> { lastTouchDistance = null; isDragging = false; });

/* MOUSE drag for PC */
canvas.addEventListener("mousedown", e => {
Â  if (!frame.img) return;
Â  isDragging = true;
Â  startX = e.clientX;
Â  startY = e.clientY;
});

canvas.addEventListener("mousemove", e => {
Â  if (!frame.img || !isDragging) return;
Â  posX += e.clientX - startX;
Â  posY += e.clientY - startY;
Â  startX = e.clientX;
Â  startY = e.clientY;
Â  draw();
});

canvas.addEventListener("mouseup", () => isDragging = false);
canvas.addEventListener("mouseleave", () => isDragging = false);

/* Scale */
sizeSlider.addEventListener("input", ()=> {
Â  imgScale = parseFloat(sizeSlider.value);
Â  draw();
});

/* Upload handlers */
imgUploadInput.addEventListener("change", handleImageSelect);
imgCameraInput.addEventListener("change", handleImageSelect);
cameraBtn.addEventListener("click", ()=> imgCameraInput.click());

/* FIXED DOWNLOAD BUTTON - Now using toDataURL for reliable, synchronous download */
downloadBtn.addEventListener("click", () => {
Â  if (!frame.img) return alert("Upload an image first!");

Â  // 1. Ensure the canvas is fully drawn
Â  draw();

Â  // 2. Convert canvas to a Data URL (Synchronous)
Â  const url = canvas.toDataURL("image/png");

Â  // 3. Create and click the download link immediately
Â  const a = document.createElement("a");
Â  a.href = url;
Â  a.download = "Rathnavalli_Sathyan_" + downloadCount + ".png";
Â  downloadCount++;
Â  document.body.appendChild(a);
Â  a.click();
Â  document.body.removeChild(a);
});

/* Reset */
resetBtn.addEventListener("click", () => {
Â  frame.img = null;
Â  uploadRow.style.display = "flex";
Â  imgScale = 1;
Â  sizeSlider.value = 1;
Â  downloadCount = 1;

Â  draw();
Â  updateUploadRowPosition();
});

/* Reposition buttons on resize */
window.addEventListener("resize", updateUploadRowPosition);
</script>

</body>
</html>
